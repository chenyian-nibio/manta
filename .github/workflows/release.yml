name: Upload assets

on:
  release:
    types: [published]

jobs:
  windows:
    name: Build windows version
    runs-on: windows
    steps:
      - uses: actions/checkout@v1
      - name: Set version number
        id: release
        run: |
          echo ::set-output name=tag::$(echo ${GITHUB_REF:10})
          echo ${GITHUB_REF:10} > version.txt

      - name: Check output
        env:
          RELEASE_VERSION: ${{ steps.release.outputs.tag }}
        run: |
          echo ${{ steps.release.outputs.tag }}
      - run: desktop/windows/build.bat
      - name: Upload Release Asset
        id: upload-release-asset
        uses: actions/upload-release-asset@v1.0.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: https://uploads.github.com/repos/${{ github.repository }}/${{ steps.release.outputs.tag }}
          asset_path: desktop/windows/releases/${{ steps.release.outputs.tag }}-windows.zip
          asset_name: ${{ steps.release.outputs.tag }}-windows.zip
          asset_content_type: application/zip
